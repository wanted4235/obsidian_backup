–ö–æ–Ω–µ—á–Ω–æ! –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤–∞—à —Ç–µ–∫—Å—Ç, –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ **Markdown (MD)** —Å –∫—Ä–∞—Å–∏–≤—ã–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º, —Ä–∞–∑–¥–µ–ª–∞–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞.

---

# üßµ –ö–ª–∞—Å—Å `ThreadPool` –≤ .NET

## üîç –û–±–∑–æ—Ä

–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ ‚Äî –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∫–∞–∫ –ø–æ –ø–∞–º—è—Ç–∏, —Ç–∞–∫ –∏ –ø–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º.  
–ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ —Ç—Ä–µ–±—É–µ—Ç:
- –û–∫–æ–ª–æ **1 –ú–ë** –ø–∞–º—è—Ç–∏;
- –ù–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ—Ç–µ–Ω –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

–ò–Ω–æ–≥–¥–∞ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ç–æ–∫–æ–≤ **—Å–Ω–∏–∂–∞–µ—Ç**, –∞ –Ω–µ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑-–∑–∞ —á–∞—Å—Ç–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –∏ –≤—ã–≥—Ä—É–∑–∫–∏/–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–∞–º—è—Ç–∏.

–í–º–µ—Å—Ç–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞–º–∏, .NET –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–ø—É–ª–∞ –ø–æ—Ç–æ–∫–æ–≤ (`ThreadPool`)**, –∫–æ—Ç–æ—Ä—ã–π:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ—Ç–æ–∫–æ–≤;
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –∏—Ö –∑–∞–¥–∞—á–∞–º;
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –ø—É–ª –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.

> –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤.

---

## ‚öôÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç ThreadPool?

- –ü—É–ª –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É.
- –í—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–º–µ—é—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—É–ª.
- CLR (Common Language Runtime) –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≥—Ä—É–∑–∫–∏ CPU.

### üìà –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –≤ –ø—É–ª–µ:

| –í–µ—Ä—Å–∏—è .NET | –ú–∞–∫—Å–∏–º—É–º –ø–æ—Ç–æ–∫–æ–≤ |
|-------------|------------------|
| .NET 2.0    | 25 –Ω–∞ —è–¥—Ä–æ       |
| .NET 3.5    | 250 –Ω–∞ —è–¥—Ä–æ      |
| .NET 4.0 (x86) | 1023            |
| .NET 4.0+ / .NET Core (x64) | 32768 |

> –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥—ã:
- `ThreadPool.SetMinThreads()`
- `ThreadPool.SetMaxThreads()`

---

## üíª –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `ThreadPool.QueueUserWorkItem`

```csharp
private static void PrintNumber10Times(object state)
{
    for (int i = 0; i < 10; i++)
    {
        Console.Write(1);
    }
    Console.WriteLine();
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –ø—É–ª–µ:

```csharp
private static void CreateThreadUsingThreadPool()
{
    ThreadPool.QueueUserWorkItem(new WaitCallback(PrintNumber10Times));
}
```

### –í—ã–∑–æ–≤ –∏–∑ `Main`:

```csharp
using System;
using System.Threading;

namespace Ch01 
{
    class _4ThreadPool 
    {
        static void Main(string[] args) 
        {
            Console.WriteLine("Start Execution!!!");
            CreateThreadUsingThreadPool();
            Console.WriteLine("Finish Execution");
            Console.ReadLine();
        }
    }
}
```

üìå **–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –°–æ–æ–±—â–µ–Ω–∏–µ `"Start Execution!!!"` –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å—Ä–∞–∑—É.
- –ú–µ—Ç–æ–¥ `PrintNumber10Times()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ.
- `"Finish Execution"` –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–≤–µ–¥–µ–Ω–æ –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ –≤—ã–≤–æ–¥–∞ —á–∏—Å–µ–ª, —Ç–∞–∫ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –Ω–µ –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏.

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ `ThreadPool`

- **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞**: –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI.
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏**: CLR —Å–∞–º–∞ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏.

---

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ `ThreadPool`

- –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å **–æ—Ç–ª–∞–¥–∫–æ–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π** –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–¥–∞—á.
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å **–æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ –∑–∞–¥–∞—á**, –∏–Ω–∞—á–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –º–æ–∂–µ—Ç –∞–≤–∞—Ä–∏–π–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è.
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
  - –û—Ç—á—ë—Ç–æ–≤ –æ —Ö–æ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è;
  - –õ–æ–≥–∏–∫–∏ –æ—Ç–º–µ–Ω—ã –∑–∞–¥–∞—á;
  - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

---

## üõë –ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ThreadPool`

–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ThreadPool`, –µ—Å–ª–∏:

- –í–∞–º –Ω—É–∂–µ–Ω **–ø–æ—Ç–æ–∫ –ø–µ—Ä–µ–¥–Ω–µ–≥–æ –ø–ª–∞–Ω–∞ (foreground thread)**.
- –¢—Ä–µ–±—É–µ—Ç—Å—è **—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —è–≤–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ—Ç–æ–∫–∞**.
- –ó–∞–¥–∞—á–∞ —è–≤–ª—è–µ—Ç—Å—è **–¥–ª–∏—Ç–µ–ª—å–Ω–æ–π –∏–ª–∏ –±–ª–æ–∫–∏—Ä—É—é—â–µ–π** ‚Äî —ç—Ç–æ –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏ –≤ –ø—É–ª–µ.
- –ù—É–∂–Ω—ã **STA-–ø–æ—Ç–æ–∫–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å COM-–æ–±—ä–µ–∫—Ç–∞–º–∏), —Ç.–∫. –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –ø—É–ª–∞ ‚Äî MTA.
- –¢—Ä–µ–±—É–µ—Ç—Å—è **–ø—Ä–∏–≤—è–∑–∞—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–ª–∏ –∏–º—è –∫ –ø–æ—Ç–æ–∫—É** ‚Äî –∏–º–µ–Ω–∞ –Ω–µ–ª—å–∑—è –∑–∞–¥–∞–≤–∞—Ç—å –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤ –∏–∑ –ø—É–ª–∞.

---

## üìù –ò—Ç–æ–≥

–ö–ª–∞—Å—Å `ThreadPool` ‚Äî —É–¥–æ–±–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è **–∫–æ—Ä–æ—Ç–∫–∏—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á**, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –≤–∞–∂–Ω–æ –∏–∑–±–µ–∂–∞—Ç—å –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.

–û–¥–Ω–∞–∫–æ, –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (–¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏, –æ—Ç–º–µ–Ω–∞, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ —Ç.–¥.) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- **TPL (Task Parallel Library)**;
- **async/await**;
- **—Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏ —á–µ—Ä–µ–∑ `Thread`**.

---

