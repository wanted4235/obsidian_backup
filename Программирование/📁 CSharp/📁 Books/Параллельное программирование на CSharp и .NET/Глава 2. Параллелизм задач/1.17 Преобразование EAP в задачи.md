# üìò –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ EAP –≤ –∑–∞–¥–∞—á–∏ (TAP)

## üîπ –í–≤–µ–¥–µ–Ω–∏–µ

–í .NET —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥–µ–ª–µ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è:

| –ú–æ–¥–µ–ª—å | –ù–∞–∑–≤–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä—ã |
|--------|----------|---------|
| **EAP** | Event-based Asynchronous Pattern | `BackgroundWorker`, `WebClient` |
| **TAP** | Task-based Asynchronous Pattern | `Task<T>`, `async/await` |

> üí° **EAP** ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∞—è –º–æ–¥–µ–ª—å, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è—Ö.  
> üí° **TAP** ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å, –±–æ–ª–µ–µ —É–¥–æ–±–Ω–∞—è –∏ —á–∏—Ç–∞–µ–º–∞—è.

–¶–µ–ª—å —ç—Ç–æ–π –≥–ª–∞–≤—ã ‚Äî –Ω–∞—É—á–∏—Ç—å—Å—è **–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å EAP-–º–µ—Ç–æ–¥—ã –≤ TAP**, –∏—Å–ø–æ–ª—å–∑—É—è `TaskCompletionSource<T>`.

---

## üîÑ –ß—Ç–æ —Ç–∞–∫–æ–µ EAP?

**EAP (Event-based Asynchronous Pattern)** ‚Äî —ç—Ç–æ –ø–æ–¥—Ö–æ–¥ –∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º:
- –î–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ñ–æ–Ω–µ.
- –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **—Å–æ–±—ã—Ç–∏–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Completed`).
- –í–æ–∑–º–æ–∂–Ω—ã —Å–æ–±—ã—Ç–∏—è –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ (`ProgressChanged`) –∏ –æ—Ç–º–µ–Ω–µ (`CancelAsync`).

### –ü—Ä–∏–º–µ—Ä EAP:
```csharp
var webClient = new WebClient();
webClient.DownloadStringCompleted += (s, e) =>
{
    if (e.Error != null)
        Console.WriteLine("–û—à–∏–±–∫–∞: " + e.Error.Message);
    else if (e.Cancelled)
        Console.WriteLine("–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞");
    else
        Console.WriteLine("–†–µ–∑—É–ª—å—Ç–∞—Ç: " + e.Result);
};

webClient.DownloadStringAsync(new Uri("http://example.com"));
```

> ‚ö†Ô∏è –¢–∞–∫–æ–π —Å—Ç–∏–ª—å —Å–ª–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –∫–æ–¥–µ –∏–∑-–∑–∞ —Å–ª–æ–∂–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏ –æ—à–∏–±–æ–∫.

---

## üß© –ö–∞–∫ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å EAP –≤ TAP?

–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å `TaskCompletionSource<T>`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç **–≤—Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–º–µ–Ω—É –∑–∞–¥–∞—á–∏**.

### –ü—Ä–∏–º–µ—Ä –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:
```csharp
private static Task<string> EAPToTask()
{
    var tcs = new TaskCompletionSource<string>();
    var webClient = new WebClient();

    webClient.DownloadStringCompleted += (sender, e) =>
    {
        if (e.Error != null)
            tcs.TrySetException(e.Error); // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—à–∏–±–∫—É
        else if (e.Cancelled)
            tcs.TrySetCanceled(); // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç–º–µ–Ω—É
        else
            tcs.TrySetResult(e.Result); // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    };

    webClient.DownloadStringAsync(new Uri("http://example.com"));

    return tcs.Task; // –í–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á—É
}
```

> ‚úÖ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ —Å `await`:
```csharp
string result = await EAPToTask();
Console.WriteLine(result);
```

---

## üõ† –ß—Ç–æ —Ç–∞–∫–æ–µ `TaskCompletionSource<T>`?

–≠—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π:
- –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –≤—Ä—É—á–Ω—É—é
- –£–ø—Ä–∞–≤–ª—è—Ç—å –µ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º: —É—Å–ø–µ—Ö, –æ—à–∏–±–∫–∞, –æ—Ç–º–µ–Ω–∞
- –û–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –ª—é–±—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ `Task<T>`

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
| –ú–µ—Ç–æ–¥ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç |
|-------|------------|
| `TrySetResult(T result)` | –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞–¥–∞—á—É —É—Å–ø–µ—à–Ω–æ |
| `TrySetException(Exception exception)` | –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞–¥–∞—á—É —Å –æ—à–∏–±–∫–æ–π |
| `TrySetCanceled()` | –û—Ç–º–µ–Ω—è–µ—Ç –∑–∞–¥–∞—á—É |
| `Task<T>` | –°–≤–æ–π—Å—Ç–≤–æ, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—É—é –∑–∞–¥–∞—á—É |

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ EAP –∏ TAP

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | EAP | TAP |
|----------------|-----|-----|
| –°–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞ | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è |
| –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∞—è |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π | –ß–µ—Ä–µ–∑ `e.Error` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `await` |
| –£–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è | –ù–∏–∑–∫–æ–µ | –í—ã—Å–æ–∫–æ–µ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ async/await | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º | ‚úÖ –ü–æ–ª–Ω–∞—è | ‚úÖ –ß–µ—Ä–µ–∑ `TaskCompletionSource` |

---

## üß† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

| –°–∏—Ç—É–∞—Ü–∏—è | –°–æ–≤–µ—Ç |
|----------|--------|
| –ï—Å—Ç—å —Å—Ç–∞—Ä—ã–π EAP-–∫–æ–¥ | –ò—Å–ø–æ–ª—å–∑—É–π `TaskCompletionSource<T>` |
| –ü–∏—à–µ—à—å –Ω–æ–≤—ã–π –∫–æ–¥ | –ò—Å–ø–æ–ª—å–∑—É–π `HttpClient`, `async/await` |
| –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –û–±–æ—Ä–∞—á–∏–≤–∞–π EAP –≤ TAP |
| –ù—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç–º–µ–Ω—É | –î–æ–±–∞–≤—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `CancellationToken` |
| –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `.Result` –∏–ª–∏ `.Wait()` –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã | –ú–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å deadlock |

---

## üõë –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å

| –ü—Ä–æ–±–ª–µ–º–∞                       | –ü—Ä–∏—á–∏–Ω–∞                                           | –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å                                         |
| ------------------------------ | ------------------------------------------------- | ----------------------------------------------------- |
| Deadlock                       | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `.Result` –∏–ª–∏ `.Wait()` –≤ UI        | –ò—Å–ø–æ–ª—å–∑—É–π `await` –≤–º–µ—Å—Ç–æ `.Wait()`                    |
| –ò—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã       | –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–æ–π                        | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π —á–µ—Ä–µ–∑ `try/catch` –ø—Ä–∏ `await`             |
| –ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –º–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å—Å—è –≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | –ò—Å–ø–æ–ª—å–∑—É–π `ConfigureAwait(false)` –≤ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω–æ–º –∫–æ–¥–µ |
| –ù–µ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è —Ä–µ—Å—É—Ä—Å—ã       | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `IDisposable`          | –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è        |

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è EAP –≤ TAP

| –ü–ª—é—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π —Å—Ç–∏–ª—å –∫–æ–¥–∞ | –í—Å–µ –∑–∞–¥–∞—á–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `Task<T>` |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `async/await` | –ö–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º |
| –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π | –ò—Å–∫–ª—é—á–µ–Ω–∏—è –ª–µ–≥–∫–æ –ª–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ `try/catch` |
| –ì–∏–±–∫–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ | –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ContinueWith`, `WhenAll`, `WhenAny` –∏ —Ç. –¥. |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –Ω–æ–≤—ã–º–∏ API | –õ–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ |

---

## üìå –ò—Ç–æ–≥

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------------|----------|
| EAP | –£—Å—Ç–∞—Ä–µ–≤—à–∞—è –º–æ–¥–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–±—ã—Ç–∏–π |
| TAP | –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —á–µ—Ä–µ–∑ `Task<T>` –∏ `async/await` |
| `TaskCompletionSource<T>` | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç EAP –≤ TAP |
| –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ TAP | –ü—Ä–æ—Å—Ç–æ—Ç–∞, —á–∏—Ç–∞–µ–º–æ—Å—Ç—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |
| –õ—É—á—à–∏–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `await` –≤–º–µ—Å—Ç–æ `.Wait()` –∏–ª–∏ `.Result` |

---
