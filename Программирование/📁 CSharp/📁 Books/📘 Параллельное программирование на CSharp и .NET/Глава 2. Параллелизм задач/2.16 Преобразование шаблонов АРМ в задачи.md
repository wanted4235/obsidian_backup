# üìò –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ APM –≤ –∑–∞–¥–∞—á–∏ (TAP)

## üîπ –í–≤–µ–¥–µ–Ω–∏–µ

–í .NET —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é:

| –ú–æ–¥–µ–ª—å | –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|----------|
| **APM** | Asynchronous Programming Model | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–æ–¥—ã `BeginXXX` / `EndXXX` –∏ `IAsyncResult` |
| **EAP** | Event-based Asynchronous Pattern | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (`Completed`) |
| **TAP** | Task-based Asynchronous Pattern | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —á–µ—Ä–µ–∑ `Task<T>` –∏ `async/await` |

> üí° –í –¥–∞–Ω–Ω–æ–º –º–∞—Ç–µ—Ä–∏–∞–ª–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è **–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑ APM –≤ TAP**, —Ç.–µ. –∫–∞–∫ **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å –Ω–æ–≤–æ–π –º–æ–¥–µ–ª—å—é —á–µ—Ä–µ–∑ –∑–∞–¥–∞—á–∏**.

---

## üîÑ –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –∫ APM

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞:
```csharp
private static void ReadFileSynchronously()
{
    string path = @"Test.txt";
    using (FileStream fs = File.OpenRead(path))
    {
        byte[] buffer = new byte[1024];
        fs.Read(buffer, 0, buffer.Length);
        Console.WriteLine(Encoding.UTF8.GetString(buffer));
    }
}
```

> ‚ö†Ô∏è –ü–æ—Ç–æ–∫ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è.

---

### 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ APM:
```csharp
private static void ReadFileUsingAPMAsyncWithoutCallback()
{
    string filePath = @"Test.txt";
    using (FileStream fs = new FileStream(filePath,
        FileMode.Open, FileAccess.Read, FileShare.Read,
        1024, FileOptions.Asynchronous))
    {
        byte[] buffer = new byte[1024];
        IAsyncResult result = fs.BeginRead(buffer, 0, buffer.Length, null, null);
        Console.WriteLine("–ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥—Ä—É–≥—É—é —Ä–∞–±–æ—Ç—É...");

        int bytesRead = fs.EndRead(result); // –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤
        Console.WriteLine(Encoding.UTF8.GetString(buffer));
    }
}
```

> ‚úÖ –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞.

---

## üß© –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ APM –≤ TAP —á–µ—Ä–µ–∑ `Task.Factory.FromAsync`

–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ APM-–º–µ—Ç–æ–¥—ã –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ TAP, –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–µ—Ç–æ–¥–æ–º `Task.Factory.FromAsync`.

### –ü—Ä–∏–º–µ—Ä:
```csharp
private static void ReadFileUsingTask()
{
    string filePath = @"Test.txt";
    using (FileStream fs = new FileStream(filePath,
        FileMode.Open, FileAccess.Read, FileShare.Read,
        1024, FileOptions.Asynchronous))
    {
        byte[] buffer = new byte[1024];
        UTF8Encoding encoder = new UTF8Encoding(true);

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º APM –≤ Task
        var task = Task<int>.Factory.FromAsync(
            fs.BeginRead,
            fs.EndRead,
            buffer, 0, buffer.Length, 
            null);

        Console.WriteLine("–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥—Ä—É–≥–∞—è —Ä–∞–±–æ—Ç–∞...");

        task.Wait(); // –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ await –≤ async –º–µ—Ç–æ–¥–µ

        Console.WriteLine(encoder.GetString(buffer));
    }
}
```

> ‚úÖ –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `async/await`.

---

## üìå –û–±—ä—è—Å–Ω–µ–Ω–∏–µ FromAsync

–ú–µ—Ç–æ–¥ `FromAsync()` —Å–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É (`Task<T>`), –∫–æ—Ç–æ—Ä–∞—è –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—ã–∑–æ–≤—ã `BeginXXX` –∏ `EndXXX`, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –∫–æ–¥–æ–º.

### –ü–æ–¥–ø–∏—Å—å –º–µ—Ç–æ–¥–∞:
```csharp
public Task<TResult> FromAsync(
    Func<...> beginMethod,
    Func<IAsyncResult, TResult> endMethod,
    object state)
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | APM | TAP |
|----------------|-----|-----|
| –°–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞ | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è |
| –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∞—è |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π | –ß–µ—Ä–µ–∑ `IAsyncResult.AsyncState` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `await` |
| –£–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è | –ù–∏–∑–∫–æ–µ | –í—ã—Å–æ–∫–æ–µ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ async/await | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º | ‚úÖ –ü–æ–ª–Ω–∞—è | ‚úÖ –ß–µ—Ä–µ–∑ `FromAsync` |

---

## üß† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

| –°–∏—Ç—É–∞—Ü–∏—è | –°–æ–≤–µ—Ç |
|----------|--------|
| –ï—Å—Ç—å —Å—Ç–∞—Ä—ã–π APM-–∫–æ–¥ | –ò—Å–ø–æ–ª—å–∑—É–π `Task.Factory.FromAsync` |
| –ü–∏—à–µ—à—å –Ω–æ–≤—ã–π –∫–æ–¥ | –ò—Å–ø–æ–ª—å–∑—É–π `async/await` –∏ `Task.Run` –∏–ª–∏ `ValueTask` |
| –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –û–±–æ—Ä–∞—á–∏–≤–∞–π APM –≤ TAP |
| –ù—É–∂–Ω–æ —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã/—Å–µ—Ç–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ | –ò—Å–ø–æ–ª—å–∑—É–π `FileStream.ReadAsync(...)` –∏–ª–∏ `HttpClient.GetAsync(...)` |
| –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `.Result` –∏–ª–∏ `.Wait()` –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã | –ú–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å deadlock |

---

## üõë –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å |
|----------|---------|----------------|
| Deadlock | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `.Wait()` –∏–ª–∏ `.Result` –≤ UI | –ò—Å–ø–æ–ª—å–∑—É–π `await` –≤–º–µ—Å—Ç–æ `.Wait()` |
| –ò—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã | –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–æ–π | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π —á–µ—Ä–µ–∑ `try/catch` –ø—Ä–∏ `await` |
| –ù–µ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è —Ä–µ—Å—É—Ä—Å—ã | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `using` | –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ `IDisposable` –æ–±—ä–µ–∫—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è |
| –ù–µ–≤–µ—Ä–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–∞ Begin/End | –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ | –°—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–π –ø–∞—Ç—Ç–µ—Ä–Ω—É APM –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π `FromAsync` |

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è APM –≤ TAP

| –ü–ª—é—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π —Å—Ç–∏–ª—å –∫–æ–¥–∞ | –í—Å–µ –∑–∞–¥–∞—á–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `Task<T>` |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `async/await` | –ö–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º |
| –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π | –ò—Å–∫–ª—é—á–µ–Ω–∏—è –ª–µ–≥–∫–æ –ª–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ `try/catch` |
| –ì–∏–±–∫–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ | –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ContinueWith`, `WhenAll`, `WhenAny` –∏ —Ç. –¥. |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –Ω–æ–≤—ã–º–∏ API | –õ–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ |

---

## üìå –ò—Ç–æ–≥

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------------|----------|
| APM | –£—Å—Ç–∞—Ä–µ–≤—à–∞—è –º–æ–¥–µ–ª—å —Å `BeginXXX` / `EndXXX` |
| TAP | –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —á–µ—Ä–µ–∑ `Task<T>` –∏ `async/await` |
| `FromAsync` | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç APM –≤ TAP |
| –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ TAP | –ü—Ä–æ—Å—Ç–æ—Ç–∞, —á–∏—Ç–∞–µ–º–æ—Å—Ç—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |
| –õ—É—á—à–∏–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `await` –≤–º–µ—Å—Ç–æ `.Wait()` –∏–ª–∏ `.Result` |

---

