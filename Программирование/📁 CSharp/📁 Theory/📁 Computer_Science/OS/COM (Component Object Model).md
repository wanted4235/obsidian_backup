–ö–æ–Ω–µ—á–Ω–æ! COM (Component Object Model) ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–∏ Microsoft, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è. –≠—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö –∏–ª–∏ –¥–∞–∂–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–ø—å—é—Ç–µ—Ä–∞—Ö.

### üìå –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ COM

#### 1. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã**
- –í—Å–µ –æ–±—ä–µ–∫—Ç—ã COM –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –º–µ—Ç–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –æ–±—ä–µ–∫—Ç.
- –ö–∞–∂–¥—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (IID ‚Äî Interface ID), –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π GUID (Globally Unique Identifier).
- –ü—Ä–∏–º–µ—Ä: `IUnknown` ‚Äî –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—Å–µ—Ö COM-–æ–±—ä–µ–∫—Ç–æ–≤.

#### 2. **IUnknown**
- –≠—Ç–æ "–∫–æ—Ä–Ω–µ–≤–æ–π" –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—Å–µ—Ö COM-–æ–±—ä–µ–∫—Ç–æ–≤.
- –°–æ–¥–µ—Ä–∂–∏—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–∞:
  - `QueryInterface()` ‚Äî –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥—Ä—É–≥–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—ä–µ–∫—Ç–∞.
  - `AddRef()` ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫.
  - `Release()` ‚Äî —É–º–µ–Ω—å—à–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫; –∫–æ–≥–¥–∞ –æ–Ω –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –Ω—É–ª—è, –æ–±—ä–µ–∫—Ç —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è.
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ –æ–±—ä–µ–∫—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –ø–æ–¥—Å—á—ë—Ç —Å—Å—ã–ª–æ–∫.

#### 3. **GUID / CLSID**
- –ö–∞–∂–¥—ã–π COM-–æ–±—ä–µ–∫—Ç –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å–æ–≤—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (CLSID).
- –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç—Ç–æ—Ç CLSID.
- –¢–∞–∫–∂–µ –µ—Å—Ç—å IID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

#### 4. **–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤**
- –û–±—ä–µ–∫—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –≤—ã–∑–æ–≤–∞ `CoCreateInstance()`, –≥–¥–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è CLSID –∏ IID.
- COM —Å–∞–º –Ω–∞—Ö–æ–¥–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, DLL –∏–ª–∏ EXE).

#### 5. **–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –∏ Threading Models**
COM –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–æ–¥–µ–ª–∏ –ø–æ—Ç–æ–∫–æ–≤:
- **Single-threaded Apartment (STA)**
- **Multi-threaded Apartment (MTA)**
- **Neutral**
–≠—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ, –∫–∞–∫ COM –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–∑–æ–≤—ã –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏ (–≤ —Ç–æ–º —á–∏—Å–ª–µ –º–∞—Ä—à–∞–ª–∏–Ω–≥).

#### 6. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è COM-–æ–±—ä–µ–∫—Ç–æ–≤**
- COM-–æ–±—ä–µ–∫—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ Windows.
- –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ø—É—Ç–∏ –∫ DLL/EXE, CLSID, ProgID –∏ —Ç.–¥.
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—ã—á–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `regsvr32.exe`.

---

### üß± –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ COM

- **–Ø–∑—ã–∫–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å COM-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ C++, C#, Delphi, VB –∏ –¥—Ä.
- **–†–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.
- **–õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –Ω–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –±–µ–∑ –ø–æ–ª–æ–º–∫–∏ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞.
- **–£–¥–∞–ª—ë–Ω–Ω—ã–π –≤—ã–∑–æ–≤ –ø—Ä–æ—Ü–µ–¥—É—Ä (DCOM)**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–æ —Å–µ—Ç–∏.

---

### üõ† –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è COM –Ω–∞ C#

```csharp
using System;
using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main(string[] args)
    {
        Excel.Application excelApp = null;
        Excel.Workbook workbook = null;
        Excel.Worksheet worksheet = null;

        try
        {
            // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä Excel
            excelApp = new Excel.Application();
            excelApp.Visible = true; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º Excel –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–Ω–∏–≥—É
            workbook = excelApp.Workbooks.Add();
            worksheet = (Excel.Worksheet)workbook.Sheets[1];

            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —è—á–µ–π–∫–∏
            worksheet.Cells[1, 1] = "–ò–º—è";
            worksheet.Cells[1, 2] = "–í–æ–∑—Ä–∞—Å—Ç";

            worksheet.Cells[2, 1] = "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä";
            worksheet.Cells[2, 2] = "30";

            worksheet.Cells[3, 1] = "–ú–∞—Ä–∏—è";
            worksheet.Cells[3, 2] = "25";

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–Ω–∏–≥—É
            string path = @"C:\temp\test_excel_com.xlsx";
            workbook.SaveAs(path);

            Console.WriteLine("Excel —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω: " + path);

            // –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å Excel –æ—Ç–∫—Ä—ã—Ç—ã–º, –∞ –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ:
            // workbook.Close();
            // excelApp.Quit();

        }
        catch (Exception ex)
        {
            Console.WriteLine("–û—à–∏–±–∫–∞: " + ex.Message);
        }
        finally
        {
            // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã (—ç—Ç–æ –≤–∞–∂–Ω–æ!)
            if (worksheet != null) System.Runtime.InteropServices.Marshal.ReleaseComObject(worksheet);
            if (workbook != null) System.Runtime.InteropServices.Marshal.ReleaseComObject(workbook);
            if (excelApp != null) System.Runtime.InteropServices.Marshal.ReleaseComObject(excelApp);

            worksheet = null;
            workbook = null;
            excelApp = null;

            GC.Collect(); // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
            GC.WaitForPendingFinalizers();
        }
    }
}
```

> –≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Excel, –æ—Ç–∫—Ä—ã—Ç—å –∫–Ω–∏–≥—É, –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ—ë. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **COM Interop** –≤ .NET.

---

### üí° –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è COM?

- **Windows API –∏ Shell** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è Office)
- **DirectX** (–Ω–∞–ø—Ä–∏–º–µ—Ä, Direct3D, DirectShow)
- **OLE (Object Linking and Embedding)**
- **ActiveX**
- **Automation (OLE Automation)**
- **Windows Runtime (WinRT)** —á–∞—Å—Ç–∏—á–Ω–æ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ COM

---

### üîÅ COM ‚Üí DCOM ‚Üí .NET Interop

- **DCOM** ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è COM –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (—Ä–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ —Å–µ—Ç—å).
- **COM+** ‚Äî –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ COM, –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –ø—É–ª–æ–≤ –ø–æ—Ç–æ–∫–æ–≤ –∏ —Ç.–¥.
- **.NET Framework** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Interop**, —á—Ç–æ–±—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å COM-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ (–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç ‚Äî COM –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å .NET —á–µ—Ä–µ–∑ CCW ‚Äî COM Callable Wrapper).

---
