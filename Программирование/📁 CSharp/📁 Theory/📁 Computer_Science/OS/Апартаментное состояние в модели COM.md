
**–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (apartment state)** ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–µ –ø–æ–Ω—è—Ç–∏–µ –≤ **[[COM (Component Object Model)]]**, –∫–æ—Ç–æ—Ä–æ–µ —Å–≤—è–∑–∞–Ω–æ —Å **—Ä–∞–±–æ—Ç–æ–π COM-–æ–±—ä–µ–∫—Ç–æ–≤ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ**.

–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º —ç—Ç–æ –ø–æ —à–∞–≥–∞–º: –æ—Ç –±–∞–∑–æ–≤—ã—Ö –ø–æ–Ω—è—Ç–∏–π –¥–æ —Å–≤—è–∑–∏ —Å –ø–æ—Ç–æ–∫–∞–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–æ–≤.

---

# üîç –ß—Ç–æ —Ç–∞–∫–æ–µ COM?

**COM (Component Object Model)** ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è Microsoft –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è **–º–æ–¥—É–ª—å–Ω—ã—Ö, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è**, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö –∏–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö/–ø–æ—Ç–æ–∫–∞—Ö.

–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Windows API
- –†–∞–±–æ—Ç–∞ —Å Excel, Word —á–µ—Ä–µ–∑ COM-–æ–±—ä–µ–∫—Ç—ã –∏–∑ .NET
- –°–æ–∑–¥–∞–Ω–∏–µ ActiveX-–∫–æ–Ω—Ç—Ä–æ–ª–æ–≤

---

# üö™ –ß—Ç–æ —Ç–∞–∫–æ–µ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (Apartment State)?

**Apartment State** ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –≤ COM, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, **–∫–∞–∫ COM-–æ–±—ä–µ–∫—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤**.

–ü–æ—Å–∫–æ–ª—å–∫—É –Ω–µ –≤—Å–µ COM-–æ–±—ä–µ–∫—Ç—ã –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã, COM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é "–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤" (apartments), —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç—É–ø–æ–º –∫ –æ–±—ä–µ–∫—Ç–∞–º –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.

---

## üì¶ –¢–∏–ø—ã –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤:

### 1. **STA (Single-Threaded Apartment) ‚Äî –û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç**

- –û–¥–∏–Ω –ø–æ—Ç–æ–∫ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ COM-–æ–±—ä–µ–∫—Ç—É.
- –ü–æ—Ç–æ–∫ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ-–æ—á–µ—Ä–µ–¥—å (message queue)** ‚Äî —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ GUI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.
- COM –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ **—Ç–æ–º –∂–µ –ø–æ—Ç–æ–∫–µ**, –≥–¥–µ –æ–Ω –±—ã–ª —Å–æ–∑–¥–∞–Ω.
- –≠—Ç–æ –≤–∞–∂–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ Windows (—Ç—Ä–µ–±—É—é—Ç STA).

üìå **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ WinForms/WPF –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.**

---

### 2. **MTA (Multi-Threaded Apartment) ‚Äî –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç**

- –û–±—ä–µ–∫—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –∏–∑ **–ª—é–±–æ–≥–æ –ø–æ—Ç–æ–∫–∞** –≤–Ω—É—Ç—Ä–∏ MTA.
- COM –Ω–µ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –≤—ã–∑–æ–≤—ã –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏.
- –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∞–º –¥–æ–ª–∂–µ–Ω –æ–±–µ—Å–ø–µ—á–∏—Ç—å **–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –∫–æ–¥–∞.

üìå **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á–∞—Ö, –ø—É–ª–∞—Ö –ø–æ—Ç–æ–∫–æ–≤.**

---

### 3. **Neutral Apartment (–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç)**

- –£–ø—Ä–∞–≤–ª—è–µ–º—ã–π COM-–º–∞—Ä—à–∞–ª–ª–µ—Ä–æ–º.
- –ù–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –Ω–∏ –æ–¥–Ω–æ–º—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ—Ç–æ–∫—É.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –¥–ª—è –º–∞—Ä—à–∞–ª–∏–Ω–≥–∞ –º–µ–∂–¥—É STA –∏ MTA.

---

# ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –ø–æ—Ç–æ–∫–∞–º–∏?

–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –≤ COM –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ **STA** –∏–ª–∏ **MTA**, –∏–Ω–∞—á–µ COM –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã COM-–æ–±—ä–µ–∫—Ç–æ–≤.

### –ü—Ä–∏–º–µ—Ä (–Ω–∞ C#):

```csharp
Thread thread = new Thread(() =>
{
    // COM-–æ–±—ä–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –≤ STA
    var excelApp = new Excel.Application();
    excelApp.Visible = true;
});

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø–æ—Ç–æ–∫–∞
thread.SetApartmentState(ApartmentState.STA);
thread.Start();
```

–ï—Å–ª–∏ —Ç—ã –ø–æ–ø—Ä–æ–±—É–µ—à—å —Å–æ–∑–¥–∞—Ç—å COM-–æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ `Excel.Application` –≤ –ø–æ—Ç–æ–∫–µ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–º ‚Äî –ø–æ–ª—É—á–∏—à—å –æ—à–∏–±–∫—É!

---

# üîÑ STA vs MTA: —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞              | STA                          | MTA                           |
|----------------------------|------------------------------|-------------------------------|
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤         | 1                            | –ú–Ω–æ–∂–µ—Å—Ç–≤–æ                     |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GUI              | ‚úÖ –î–∞                        | ‚ùå –ù–µ—Ç                        |
| –ú–∞—Ä—à–∞–ª–∏–Ω–≥ –≤—ã–∑–æ–≤–æ–≤          | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å  | –ù–µ—Ç, –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å      |
| –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å         | ‚ùå –ù–µ—Ç                       | ‚úÖ –î–∞                         |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ              | WinForms, WPF                | –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø—É–ª –ø–æ—Ç–æ–∫–æ–≤ |

---

# üí° –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

COM-–æ–±—ä–µ–∫—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω—ã –±–µ–∑ —É—á—ë—Ç–∞ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏. –ß—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, COM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã –∫–∞–∫ —Å–ø–æ—Å–æ–± –∏–∑–æ–ª—è—Ü–∏–∏.

- –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –Ω–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω ‚Äî –µ–≥–æ –ø–æ–º–µ—â–∞—é—Ç –≤ **STA**.
- –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω ‚Äî –µ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ **MTA**.

---

# üß± –ì–¥–µ –µ—â—ë –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è?

- **Interop —Å Excel/Word**: —Ç—Ä–µ–±—É–µ—Ç STA.
- **Windows Forms**: –≥–ª–∞–≤–Ω—ã–π –ø–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ STA.
- **BackgroundWorker / Task.Run**: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ MTA, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –¥–ª—è COM-–¥–æ—Å—Ç—É–ø–∞.
- **PowerShell**: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ MTA, –Ω–æ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ STA –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å COM.

---

# üéØ –í—ã–≤–æ–¥

- **–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (ApartmentState)** ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º, **–∫–∞–∫ –ø–æ—Ç–æ–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å COM-–æ–±—ä–µ–∫—Ç–∞–º–∏**.
- **STA** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è GUI –∏ –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã—Ö COM-–æ–±—ä–µ–∫—Ç–æ–≤.
- **MTA** –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –∑–∞–¥–∞—á, –≥–¥–µ –Ω—É–∂–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å COM-–æ–±—ä–µ–∫—Ç–∞–º–∏.

---
