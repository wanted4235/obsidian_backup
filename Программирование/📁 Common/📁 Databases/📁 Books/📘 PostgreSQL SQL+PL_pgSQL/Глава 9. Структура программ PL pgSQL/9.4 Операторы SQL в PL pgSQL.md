## üîπ 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ SELECT

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ PL/pgSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:

```sql
SELECT —Å—Ç–æ–ª–±—Ü—ã INTO [STRICT] –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ FROM ...
```

### –ü—Ä–∏–º–µ—Ä:
```sql
DO $$
DECLARE
    emp_name TEXT;
    emp_salary NUMERIC;
BEGIN
    SELECT name, salary INTO emp_name, emp_salary
    FROM employees
    WHERE id = 1;

    RAISE NOTICE '–ò–º—è: %, –ó–∞—Ä–ø–ª–∞—Ç–∞: %', emp_name, emp_salary;
END $$;
```

### –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `INTO STRICT`
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–æ–ª–µ–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ ‚Äî –æ—à–∏–±–∫–∞.
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –≤–µ—Ä–Ω—É–ª –Ω–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ ‚Äî —Ç–∞–∫–∂–µ –æ—à–∏–±–∫–∞.

```sql
SELECT name INTO STRICT emp_name FROM employees WHERE id = 999;
-- –í—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
```

> ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `INTO STRICT` –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

---

## üîπ 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ INSERT

–ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

### –ü—Ä–∏–º–µ—Ä:
```sql
DO $$
DECLARE
    new_name TEXT := '–ê–ª–µ–∫—Å–µ–π';
    new_salary NUMERIC := 75000;
BEGIN
    INSERT INTO employees (name, salary)
    VALUES (new_name, new_salary);

    RAISE NOTICE '–ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞';
END $$;
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:
```sql
DO $$
DECLARE
    new_id INTEGER;
BEGIN
    INSERT INTO employees (name, salary)
    VALUES ('–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', 80000)
    RETURNING id INTO new_id;

    RAISE NOTICE '–ù–æ–≤—ã–π ID: %', new_id;
END $$;
```

> ‚úÖ `RETURNING` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `id`).

---

## üîπ 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ UPDATE

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

### –ü—Ä–∏–º–µ—Ä:
```sql
DO $$
DECLARE
    emp_id INTEGER := 1;
    new_salary NUMERIC := 85000;
BEGIN
    UPDATE employees
    SET salary = new_salary
    WHERE id = emp_id;

    RAISE NOTICE '–ó–∞—Ä–ø–ª–∞—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ % –æ–±–Ω–æ–≤–ª–µ–Ω–∞', emp_id;
END $$;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Å—Ç—Ä–æ–∫:
```sql
DO $$
DECLARE
    rows_affected INTEGER;
BEGIN
    UPDATE employees
    SET salary = salary * 1.1
    WHERE department = 'IT';

    GET DIAGNOSTICS rows_affected = ROW_COUNT;

    RAISE NOTICE '–û–±–Ω–æ–≤–ª–µ–Ω–æ % —Å—Ç—Ä–æ–∫', rows_affected;
END $$;
```

> ‚úÖ –ü–æ–ª–µ–∑–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ.

---

## üîπ 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ DELETE

–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–ª–∏ —É—Å–ª–æ–≤–∏–π.

### –ü—Ä–∏–º–µ—Ä:
```sql
DO $$
DECLARE
    emp_id INTEGER := 5;
BEGIN
    DELETE FROM employees
    WHERE id = emp_id;

    RAISE NOTICE '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å ID % —É–¥–∞–ª–µ–Ω', emp_id;
END $$;
```

### –£–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
```sql
DO $$
DECLARE
    deleted_name TEXT;
BEGIN
    DELETE FROM employees
    WHERE id = 2
    RETURNING name INTO deleted_name;

    RAISE NOTICE '–£–¥–∞–ª—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫: %', deleted_name;
END $$;
```

> ‚úÖ `RETURNING` —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ —Å `DELETE`.

---

## üîπ 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ MERGE

# üìå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `MERGE` –¥–ª—è —Å–ª–∏—è–Ω–∏—è —Ç–∞–±–ª–∏—Ü

–û–ø–µ—Ä–∞—Ç–æ—Ä `MERGE` –ø–æ–∑–≤–æ–ª—è–µ—Ç **–æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥–≤—É—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**, –≤—ã–ø–æ–ª–Ω—è—è **–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π** –∏–ª–∏ **–≤—Å—Ç–∞–≤–∫—É –Ω–æ–≤—ã—Ö**, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è.

## üîç –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `MERGE`

–í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ (—Å–º. **–õ–∏—Å—Ç–∏–Ω–≥ 9.26**) –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `MERGE` –¥–ª—è **—Å–ª–∏—è–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü—ã `Products_l`** —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `Products`, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞ `rating_p = 3`.

### ‚úÖ –¶–µ–ª—å:
- –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü–µ `Products_l`, –µ—Å–ª–∏ –æ–Ω–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã, –µ—Å–ª–∏ –∏—Ö –µ—â—ë –Ω–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ.

---

## üßæ –õ–∏—Å—Ç–∏–Ω–≥ 9.26. –°–ª–∏—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `Products_l` —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞

```sql
DO $$
DECLARE
    v_rating Products_l.rating_p%TYPE := 3;
BEGIN
    MERGE INTO Products_l pd
    USING (
        SELECT product_id, product_name, rating_p, price
        FROM Products
        WHERE rating_p = v_rating
    ) pr
    ON (pd.product_name = INITCAP(pr.product_name))
    WHEN MATCHED THEN
        UPDATE SET price = pr.price
    WHEN NOT MATCHED THEN
        INSERT (product_id, product_name, rating_p, price)
        VALUES (
            pr.product_id,
            INITCAP(pr.product_name),
            pr.rating_p,
            pr.price
        );
END $$;
```

---

## üß† –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–ó–∞–ø—Ä–æ—Å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º —Ä–µ–π—Ç–∏–Ω–≥–∞ 3** –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `Products`.
- **–°–ª–∏—è–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ –ø–æ–ª—é `product_name`.**
- –í —Ç–∞–±–ª–∏—Ü–µ `Products_l` –∑–Ω–∞—á–µ–Ω–∏—è `product_name` —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **–µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ**.
- –í —Ç–∞–±–ª–∏—Ü–µ `Products` –∑–Ω–∞—á–µ–Ω–∏—è `product_name` –º–æ–≥—É—Ç –±—ã—Ç—å **–≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ö** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `"–Ω–æ—É—Ç–±—É–∫"`, `"–ù–æ—É—Ç–±—É–∫"`, `"–ù–û–£–¢–ë–£–ö"`).

üìå –ß—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `INITCAP()`:
```sql
ON (pd.product_name = INITCAP(pr.product_name))
```

–§—É–Ω–∫—Ü–∏—è `INITCAP(str)` –ø—Ä–∏–≤–æ–¥–∏—Ç —Å—Ç—Ä–æ–∫—É –∫ –≤–∏–¥—É, –≤ –∫–æ—Ç–æ—Ä–æ–º **–∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã**, –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî —Å—Ç—Ä–æ—á–Ω—ã–µ. –ù–∞–ø—Ä–∏–º–µ—Ä:
- `"–Ω–æ—É—Ç–±—É–∫"` ‚Üí `"–ù–æ—É—Ç–±—É–∫"`
- `"–ù–û–£–¢–ë–£–ö"` ‚Üí `"–ù–æ—É—Ç–±—É–∫"`

> ‚ùó –ë–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `INITCAP` —Å—Ç—Ä–æ–∫–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–µ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–æ–≤–∞—Ä, –Ω–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ö, –±—É–¥—É—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è —Ä–∞–∑–Ω—ã–º–∏. –≠—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö.

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã `MERGE`

- –î–ª—è **—Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö —Å—Ç—Ä–æ–∫** (MATCHED) –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ü–µ–Ω–∞ (`price`).
- –î–ª—è **–Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö —Å—Ç—Ä–æ–∫** (NOT MATCHED) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å—Ç–∞–≤–∫–∞ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—É `Products_l`.

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

| –°–æ–≤–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `INITCAP` | –ü—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å —Ä–µ–≥–∏—Å—Ç—Ä–æ–º |
| –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π | –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—è, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–ª–∏—è–Ω–∏–µ, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã |
| –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö | –ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ü–∏–π `MERGE` –≤ –±–æ–µ–≤–æ–π —Å—Ä–µ–¥–µ |

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

| –û–ø–µ—Ä–∞—Ç–æ—Ä | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|---------|-------------|
| `SELECT INTO` | –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ |
| `INSERT` | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `RETURNING` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π |
| `UPDATE` | –õ—É—á—à–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Å—Ç—Ä–æ–∫ (`GET DIAGNOSTICS`) |
| `DELETE` | –¢–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `RETURNING` |
| `MERGE` | –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é, –Ω–æ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `INSERT ... ON CONFLICT` |

üìå –í PL/pgSQL SQL-–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ `BEGIN ... END`, –∏ –º–æ–≥—É—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏.

---
