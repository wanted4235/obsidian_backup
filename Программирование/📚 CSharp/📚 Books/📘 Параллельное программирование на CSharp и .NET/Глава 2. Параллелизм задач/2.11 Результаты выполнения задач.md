# üìò –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–∑ –∑–∞–¥–∞—á–∏ (`Task<T>`) –≤ .NET

–í –æ—Å–Ω–æ–≤–µ TPL –ª–µ–∂–∏—Ç –æ–±—â–∏–π (generic) –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π 
–≤–µ—Ä–Ω—É—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∑–∞–¥–∞—á. –°¬†—ç—Ç–∏–º–∏ –∫–ª–∞—Å—Å–∞–º–∏ –º—ã —Å¬†–≤–∞–º–∏ —É–∂–µ –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å 
—Ä–∞–Ω–µ–µ:
- `Task<T>`
- `Task.Factory.StartNew<T>`
- `Task.Run<T>`
–ö–∞–∫ —Ç–æ–ª—å–∫–æ –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, –º—ã —Å–º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –æ—Ç –Ω–µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ–±—Ä–∞—Ç–∏–≤—à–∏—Å—å –∫¬†—Å–≤–æ–π—Å—Ç–≤—É **Task.Result**.

---
## üîπ –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ –∑–∞–¥–∞—á–∏?

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–≤–æ–π—Å—Ç–≤–æ `.Result`.

```csharp
private static void GetResultsFromTasks() {
    // 1. –ß–µ—Ä–µ–∑ new Task<int>
    var sumTaskViaTaskOfInt = new Task<int>(() => Sum(5));
    sumTaskViaTaskOfInt.Start();
    Console.WriteLine($"Result from sumTask is {sumTaskViaTaskOfInt.Result}");

    // 2. –ß–µ—Ä–µ–∑ Task.Factory.StartNew<int>
    var sumTaskViaFactory = Task.Factory.StartNew<int>(() => Sum(5));
    Console.WriteLine($"Result from sumTask is {sumTaskViaFactory.Result}");

    // 3. –ß–µ—Ä–µ–∑ Task.Run<int>
    var sumTaskViaTaskRun = Task.Run<int>(() => Sum(5));
    Console.WriteLine($"Result from sumTask is {sumTaskViaTaskRun.Result}");

    // 4. –ß–µ—Ä–µ–∑ Task.FromResult<int>
    var sumTaskViaTaskResult = Task.FromResult<int>(Sum(5));
    Console.WriteLine($"Result from sumTask is {sumTaskViaTaskResult.Result}");
}

private static int Sum(int n) {
    int sum = 0;
    for (int i = 0; i < n; i++) {
        sum += i;
    }
    return sum;
}
```

---
### ‚ö†Ô∏è –í–∞–∂–Ω–æ:

- `.Result` **–±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–∑—ã–≤–∞—é—â–∏–π –ø–æ—Ç–æ–∫** , –ø–æ–∫–∞ –∑–∞–¥–∞—á–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ **deadlock'—É** , –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ UI-–ø–æ—Ç–æ–∫–µ –∏–ª–∏ –≤ ASP.NET –±–µ–∑ –¥–æ–ª–∂–Ω—ã—Ö –ø—Ä–µ–¥–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–µ–π.

---
## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `.Result`?

- –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ **—É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞** , –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
- –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ **–µ—â—ë –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è** , —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ **–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è** , –ø–æ–∫–∞ –æ–Ω–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.
- –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ **–∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π** , –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ `AggregateException`.

---
## üìå –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å `Task<T>` –∏ `.Result`

| –°–∏—Ç—É–∞—Ü–∏—è                                            | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è                                         |
| --------------------------------------------------- | ---------------------------------------------------- |
| –ò—Å–ø–æ–ª—å–∑—É–π`await`–≤–º–µ—Å—Ç–æ`.Result`                     | –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ deadlock'–æ–≤              |
| –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π`.Result`–≤ UI-–ø–æ—Ç–æ–∫–µ                    | –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–∞–≤–∏—Å–∞–Ω–∏—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–ª–∏ deadlock'—É |
| –ò—Å–ø–æ–ª—å–∑—É–π`ConfigureAwait(false)`–≤ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω–æ–º –∫–æ–¥–µ | –ß—Ç–æ–±—ã –Ω–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç                        |
| –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å`.Result`        | –ù–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã —É–≤–µ—Ä–µ–Ω—ã –≤ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞—á–∏     |
| –ò—Å–ø–æ–ª—å–∑—É–π`Task.FromResult()`–¥–ª—è –º–æ–∫–æ–≤               | –ü–æ–ª–µ–∑–Ω–æ –≤ unit-—Ç–µ—Å—Ç–∞—Ö –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–∏                  |

---
## üß† –ü—Ä–∏–º–µ—Ä —Å async/await (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±):

```csharp
private static async Task GetResultsAsync()
{
    int result1 = await Task.Run(() => Sum(5));
    Console.WriteLine($"Result 1: {result1}");

    int result2 = await Task.FromResult(Sum(5));
    Console.WriteLine($"Result 2: {result2}");
}
```

> ‚úÖ –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –¥–ª—è UI –∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

---
## üõë –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å

| –ü—Ä–æ–±–ª–µ–º–∞              | –ü—Ä–∏—á–∏–Ω–∞                                | –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å                                     |
| --------------------- | -------------------------------------- | ------------------------------------------------- |
| Deadlock              | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ`.Result`–≤ UI –∏–ª–∏ ASP.NET | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ`await`–≤–º–µ—Å—Ç–æ`.Result`                 |
| –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞     | –í—ã–∑–æ–≤`.Result`–Ω–∞ –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ  | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ`await`                                |
| –ò—Å–∫–ª—é—á–µ–Ω–∏—è –≤`.Result` | –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–æ–π             | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —á–µ—Ä–µ–∑`try/catch`–∏–ª–∏`task.Exception` |
