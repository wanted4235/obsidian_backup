# üìò –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á (TPL)

## üîπ –í–≤–µ–¥–µ–Ω–∏–µ

–í –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —á–∞—Å—Ç–æ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å **–æ–∂–∏–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–¥–Ω–æ–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–¥–∞—á** –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã. .NET –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ—â–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ —á–µ—Ä–µ–∑ Task Parallel Library (TPL):

| –ú–µ—Ç–æ–¥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|------------|
| `Task.Wait()` | –û–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **–æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏** |
| `Task.WaitAll()` | –û–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **–≤—Å–µ—Ö –∑–∞–¥–∞—á** |
| `Task.WaitAny()` | –û–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **—Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏** |
| `Task.WhenAll()` | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **–≤—Å–µ—Ö –∑–∞–¥–∞—á** |
| `Task.WhenAny()` | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **—Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏** |

> ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `WhenAll` –∏ `WhenAny` –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ (`async/await`), –∞ `WaitAll` –∏ `WaitAny` ‚Äî –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º.

---

## 1Ô∏è‚É£ `Task.Wait()`

### üí° –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
–ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–∑—ã–≤–∞—é—â–∏–π –ø–æ—Ç–æ–∫ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.

### ‚úÖ –ü—Ä–∏–º–µ—Ä:
```csharp
var task = Task.Run(() => Console.WriteLine("–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–¥–∞—á–∞"));
task.Wait(); // –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
Console.WriteLine("–ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
```

### ‚öôÔ∏è –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∏:
- `task.Wait()` ‚Äì –∂–¥—ë—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
- `task.Wait(int millisecondsTimeout)` ‚Äì –∂–¥—ë—Ç –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
- `task.Wait(TimeSpan timeout)` ‚Äì –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ —Å `TimeSpan`
- `task.Wait(CancellationToken)` ‚Äì –º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ
- `task.Wait(int, CancellationToken)` ‚Äì —Å —Ç–∞–π–º–∞—É—Ç–æ–º –∏ –æ—Ç–º–µ–Ω–æ–π

> ‚ö†Ô∏è –ú–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å deadlock –≤ UI –∏–ª–∏ ASP.NET –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–µ–∑ `ConfigureAwait(false)`

---

## 2Ô∏è‚É£ `Task.WaitAll(params Task[])`

### üí° –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
–ñ–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **–≤—Å–µ—Ö —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á**. –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫.

### ‚úÖ –ü—Ä–∏–º–µ—Ä:
```csharp
var t1 = Task.Run(() => Console.WriteLine("–ó–∞–¥–∞—á–∞ 1"));
var t2 = Task.Run(() => Console.WriteLine("–ó–∞–¥–∞—á–∞ 2"));

Task.WaitAll(t1, t2);
Console.WriteLine("–í—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã");
```

### ‚öôÔ∏è –ü–æ–ª–µ–∑–Ω—ã–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏:
- `Task.WaitAll(Task[], int)` ‚Äì —Å —Ç–∞–π–º–∞—É—Ç–æ–º
- `Task.WaitAll(Task[], CancellationToken)` ‚Äì —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã

> ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è **–≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.

---

## 3Ô∏è‚É£ `Task.WaitAny(params Task[])`

### üí° –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
–ñ–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **—Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏** –∏–∑ —Å–ø–∏—Å–∫–∞. –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫.

### ‚úÖ –ü—Ä–∏–º–µ—Ä:
```csharp
var t1 = Task.Delay(1000);
var t2 = Task.Delay(500);

int index = Task.WaitAny(t1, t2);
Console.WriteLine($"–ü–µ—Ä–≤–æ–π –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –∑–∞–¥–∞—á–∞ #{index + 1}");
```

> ‚úÖ –ü–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–∞–∫ —Ç–æ–ª—å–∫–æ **–ø–µ—Ä–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ—Ç–æ–≤**.

---

## 4Ô∏è‚É£ `Task.WhenAll(params Task[])`

### üí° –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **–≤—Å–µ—Ö –∑–∞–¥–∞—á**. –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫.

### ‚úÖ –ü—Ä–∏–º–µ—Ä:
```csharp
var t1 = Task.Run(() => "–†–µ–∑—É–ª—å—Ç–∞—Ç 1");
var t2 = Task.Run(() => "–†–µ–∑—É–ª—å—Ç–∞—Ç 2");

string[] results = await Task.WhenAll(t1, t2);
Console.WriteLine($"–ü–æ–ª—É—á–µ–Ω–æ: {results[0]}, {results[1]}");
```

> ‚úÖ –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `async/await` –∫–æ–¥–µ –≤–º–µ—Å—Ç–æ `WaitAll`.

---

## 5Ô∏è‚É£ `Task.WhenAny(params Task[])`

### üí° –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **—Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏**. –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫.

### ‚úÖ –ü—Ä–∏–º–µ—Ä:
```csharp
var t1 = Task.Delay(1000);
var t2 = Task.Delay(500);

Task completed = await Task.WhenAny(t1, t2);
Console.WriteLine("–ü–µ—Ä–≤–∞—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞:");
```

> ‚úÖ –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º, –≤—ã–±–æ—Ä–æ—á–Ω–æ–≥–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –æ–∂–∏–¥–∞–Ω–∏—è

| –ú–µ—Ç–æ–¥ | –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫? | –î–ª—è –∫–∞–∫–æ–π —Ü–µ–ª–∏? | –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ async –∫–æ–¥–µ? |
|-------|------------------|------------------|-------------------------------|
| `Task.Wait()` | ‚úÖ –î–∞ | –û–∂–∏–¥–∞–Ω–∏–µ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏ | ‚ùå –ù–µ—Ç |
| `Task.WaitAll()` | ‚úÖ –î–∞ | –û–∂–∏–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á | ‚ùå –ù–µ—Ç |
| `Task.WaitAny()` | ‚úÖ –î–∞ | –û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –∑–∞–¥–∞—á–∏ | ‚ùå –ù–µ—Ç |
| `Task.WhenAll()` | ‚ùå –ù–µ—Ç | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á | ‚úÖ –î–∞ |
| `Task.WhenAny()` | ‚ùå –ù–µ—Ç | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –∑–∞–¥–∞—á–∏ | ‚úÖ –î–∞ |

---

## üß† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

| –°–∏—Ç—É–∞—Ü–∏—è | –°–æ–≤–µ—Ç |
|----------|--------|
| –ù—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è **–≤—Å–µ—Ö –∑–∞–¥–∞—á** | –ò—Å–ø–æ–ª—å–∑—É–π `Task.WhenAll()` –≤ async-–∫–æ–¥–µ –∏–ª–∏ `Task.WaitAll()` –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º |
| –ù—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é –∑–∞–¥–∞—á—É | –ò—Å–ø–æ–ª—å–∑—É–π `Task.WhenAny()` |
| –ù—É–∂–µ–Ω —Ç–∞–π–º–∞—É—Ç –∏–ª–∏ –æ—Ç–º–µ–Ω–∞ | –î–æ–±–∞–≤—å –ø–∞—Ä–∞–º–µ—Ç—Ä `CancellationToken` –∏–ª–∏ `int timeout` |
| –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `.Result` –∏–ª–∏ `.Wait()` –≤ UI –∏–ª–∏ ASP.NET | –ú–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å deadlock |
| –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –∏—Å–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ `try/catch` | –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `await`, –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ–±–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è –≤ `AggregateException` |

---

## üõë –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å |
|----------|---------|----------------|
| Deadlock | –í—ã–∑–æ–≤ `.Wait()` –∏–ª–∏ `.Result` –≤ UI –∏–ª–∏ ASP.NET | –ò—Å–ø–æ–ª—å–∑—É–π `await` –≤–º–µ—Å—Ç–æ `.Wait()` |
| –ò—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã | –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–æ–π | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π —á–µ—Ä–µ–∑ `try/catch` –∏–ª–∏ `task.Exception` |
| –¢–∞–π–º–∞—É—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω | –î–æ–ª–≥–æ –≤—ã–ø–æ–ª–Ω—è—é—â–∞—è—Å—è –∑–∞–¥–∞—á–∞ | –£–∫–∞–∑—ã–≤–∞–π —Ç–∞–π–º–µ—Ä –∏–ª–∏ –æ—Ç–º–µ–Ω—É |
| –ü–æ—Ç–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `WaitAll` / `WaitAny` | –ò—Å–ø–æ–ª—å–∑—É–π `WhenAll` / `WhenAny` –≤ async –∫–æ–¥–µ |

---

## ‚úÖ –ò—Ç–æ–≥

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------------|----------|
| `Task.Wait()` | –ë–ª–æ–∫–∏—Ä—É—é—â–µ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏ |
| `Task.WaitAll()` | –ë–ª–æ–∫–∏—Ä—É—é—â–µ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á |
| `Task.WaitAny()` | –ë–ª–æ–∫–∏—Ä—É—é—â–µ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –∑–∞–¥–∞—á–∏ |
| `Task.WhenAll()` | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á |
| `Task.WhenAny()` | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –∑–∞–¥–∞—á–∏ |
| –õ—É—á—à–∏–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã | `await Task.WhenAll(...)` –∏–ª–∏ `await Task.WhenAny(...)` |

---

