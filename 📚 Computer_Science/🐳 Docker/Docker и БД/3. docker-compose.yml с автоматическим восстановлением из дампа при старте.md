–ö–æ–Ω–µ—á–Ω–æ! –í–æ—Ç –ø—Ä–∏–º–µ—Ä **`docker-compose.yml`**, –∫–æ—Ç–æ—Ä—ã–π:

1. –ó–∞–ø—É—Å–∫–∞–µ—Ç PostgreSQL,
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π volume** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö,
3. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –±–∞–∑—É –∏–∑ SQL-–¥–∞–º–ø–∞**, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ init/
‚îÇ   ‚îî‚îÄ‚îÄ restore.sql
```

–§–∞–π–ª `init/restore.sql` ‚Äî —ç—Ç–æ —Ç–≤–æ–π –¥–∞–º–ø –±–∞–∑—ã (—Ä–µ–∑—É–ª—å—Ç–∞—Ç `pg_dump` –∏–ª–∏ —Ä—É—á–Ω–æ–π SQL).

---

## üê≥ `docker-compose.yml`

```yaml
version: '3.8'

services:
  db:
    image: postgres:15
    container_name: postgres-db
    environment:
      POSTGRES_DB: myapp
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: secret
    ports:
      - "5432:5432"
    volumes:
      - db-/var/lib/postgresql/data
      - ./init:/docker-entrypoint-initdb.d
    restart: unless-stopped

volumes:
  db-
```

---

## üì• –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `./init:/docker-entrypoint-initdb.d`?

Docker-–æ–±—Ä–∞–∑ `postgres` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `.sql`, `.sql.gz`, –∏ `.sh` —Ñ–∞–π–ª–æ–≤ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/docker-entrypoint-initdb.d`, **–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –ø—É—Å—Ç–æ–π –±–∞–∑—ã**.

> üîπ –≠—Ç–æ –∑–Ω–∞—á–∏—Ç: –µ—Å–ª–∏ volume **–ø—É—Å—Ç–æ–π** (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫), —Ç–æ PostgreSQL –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ SQL-—Ñ–∞–π–ª—ã –∏–∑ `./init`.  
> üîπ –ï—Å–ª–∏ volume **—É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ** ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è **–Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è**, –∏ –¥–∞–º–ø –Ω–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è (—ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ ‚Äî –Ω–µ –ø–µ—Ä–µ–∑–∞—Ç—Ä—ë—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ).

---

## ‚úÖ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤—å –¥–∞–º–ø

–°–æ–∑–¥–∞–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ –ø–æ–ª–æ–∂–∏ —Ç—É–¥–∞ –¥–∞–º–ø:

```bash
mkdir -p init
pg_dump -U postgres -h localhost -p 5432 myapp > init/restore.sql
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–π —Ñ–∞–π–ª —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```sql
-- init/restore.sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100)
);

INSERT INTO users (name) VALUES ('–ê–ª–∏—Å–∞'), ('–ë–æ–±'), ('–ß–∞—Ç–∏–∫');
```

---

### 2. –ó–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
docker-compose up -d
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ (–∫–æ–≥–¥–∞ volume –ø—É—Å—Ç–æ–π):

- PostgreSQL —Å–æ–∑–¥–∞—Å—Ç –±–∞–∑—É `myapp`,
- –í—ã–ø–æ–ª–Ω–∏—Ç `restore.sql` ‚Üí —Ç–∞–±–ª–∏—Ü—ã –∏ –¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è.

---

### 3. –ü—Ä–æ–≤–µ—Ä—å –¥–∞–Ω–Ω—ã–µ

```bash
docker exec -it postgres-db psql -U postgres -d myapp
```

```sql
SELECT * FROM users;
```

–¢—ã –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥–∞–º–ø–∞.

---

## üîÅ –ß—Ç–æ –±—É–¥–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ?

- –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–ø–∞–¥—ë—Ç –∏–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç—Å—è ‚Äî –¥–∞–Ω–Ω—ã–µ –≤ `db-data` –æ—Å—Ç–∞–Ω—É—Ç—Å—è.
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º `docker-compose up` ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç —Å—Ç–∞—Ä—ã–π volume, –∏ **–Ω–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å `restore.sql` —Å–Ω–æ–≤–∞** (–ø–æ—Ç–æ–º—É —á—Ç–æ –ë–î —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞).
- –≠—Ç–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ**.

---

## üí° –ö–∞–∫ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –¥–∞–º–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Å–±—Ä–æ—Å–∞ –ë–î)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å **–æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥–∞–º–ø–∞**, –Ω—É–∂–Ω–æ **—É–¥–∞–ª–∏—Ç—å volume**:

```bash
docker-compose down
docker volume rm projectname_db-data   # –∏–º—è –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —á–µ—Ä–µ–∑ `docker volume ls`
docker-compose up -d
```

–¢–µ–ø–µ—Ä—å volume –ø—É—Å—Ç–æ–π ‚Üí –¥–∞–º–ø –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è —Å–Ω–æ–≤–∞.

> ‚ö†Ô∏è –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã! –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –≤ dev/staging.

---

## üõ°Ô∏è –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: –≤—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–º–ø (–¥–∞–∂–µ –µ—Å–ª–∏ –ë–î –Ω–µ –ø—É—Å—Ç–∞—è)

–ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ **–≤—Å–µ–≥–¥–∞** –ø—Ä–∏–º–µ–Ω—è—Ç—å –¥–∞–º–ø –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ç–µ—Å—Ç–æ–≤), –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç:

### `init/restore-always.sh`

```bash
#!/bin/bash
set -e

echo "üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ –¥–∞–º–ø–∞..."

psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" <<-'SQL'
    DROP TABLE IF EXISTS users;
SQL

psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" -f /docker-entrypoint-initdb.d/restore.sql
```

–°–¥–µ–ª–∞–π –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
chmod +x init/restore-always.sh
```

–ò –¥–æ–±–∞–≤—å –≤ `docker-compose.yml`:

```yaml
volumes:
  - ./init:/docker-entrypoint-initdb.d
```

> –ù–æ —É—á—Ç–∏: —ç—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ**, –ø–æ—Ç–æ–º—É —á—Ç–æ `/docker-entrypoint-initdb.d` —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑.

---

## üîÅ –ß—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–∞–º–ø **–∫–∞–∂–¥—ã–π —Ä–∞–∑**, –Ω—É–∂–Ω–æ —Å–≤–æ–π entrypoint.

–ü—Ä–∏–º–µ—Ä `init/entrypoint.sh`:

```bash
#!/bin/bash
set -e

# –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å–∫–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π entrypoint (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
docker-entrypoint.sh postgres &

# –ñ–¥—ë–º, –ø–æ–∫–∞ PostgreSQL –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
until pg_isready -U postgres -d myapp; do
  sleep 2
done

# –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–∞–º–ø
echo "üîÅ –ü—Ä–∏–º–µ–Ω—è—é SQL-–¥–∞–º–ø..."
psql -U postgres -d myapp -f /docker-entrypoint-initdb.d/restore.sql

# –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
wait
```

–ò –≤ `docker-compose.yml`:

```yaml
services:
  db:
    image: postgres:15
    entrypoint: ["/docker-entrypoint-initdb.d/entrypoint.sh"]
    volumes:
      - ./init:/docker-entrypoint-initdb.d
      - db-/var/lib/postgresql/data
```

---

## ‚úÖ –í—ã–≤–æ–¥

- `docker-compose` + `volume` + `init/.sql` ‚Äî –æ—Ç–ª–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ**.
- –î–∞–Ω–Ω—ã–µ **—Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
- –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ ‚Äî —É–¥–∞–ª–∏ volume.
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ ‚Äî –¥–æ–±–∞–≤—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.

---
