–û—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–π –∏ **–æ—á–µ–Ω—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π** –≤–æ–ø—Ä–æ—Å! üëè  
–¢—ã —É–∂–µ —Ä–∞–∑–æ–±—Ä–∞–ª—Å—è —Å –¥–∞–º–ø–∞–º–∏, volume‚Äô–∞–º–∏ ‚Äî —Ç–µ–ø–µ—Ä—å –¥–∞–≤–∞–π –ø–æ—Å–º–æ—Ç—Ä–∏–º, **–∫–∞–∫ —ç—Ç–æ —É—Å—Ç—Ä–æ–µ–Ω–æ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö**.

---

## üß± –°–Ω–∞—á–∞–ª–∞ ‚Äî –∫–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø

> ‚ùó **–î–∞–Ω–Ω—ã–µ –±–∞–∑—ã (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ volume‚Äô–µ ‚Äî —ç—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.**  
> ‚ùó **–ê –¥–∞–º–ø—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏) ‚Äî –ù–ï —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–æ–º –∂–µ volume, —á—Ç–æ –∏ —Å–∞–º–∞ –ë–î.**  
> –û–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è **–æ—Ç–¥–µ–ª—å–Ω–æ**, —á—Ç–æ–±—ã –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ volume‚Äô–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–±–æ–π –¥–∏—Å–∫–∞) ‚Äî **—Ö–æ—Ç—è –±—ã –¥–∞–º–ø—ã –æ—Å—Ç–∞–ª–∏—Å—å**.

---

## üì¶ –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç –¥–∞–º–ø—ã –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö?

| –ú–µ—Å—Ç–æ | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|------|------|--------|-------------|
| üîπ **–û—Ç–¥–µ–ª—å–Ω—ã–π volume** | –ü—Ä–æ—Å—Ç–æ, –≤ Docker | –ù–µ –∑–∞—â–∏—â—ë–Ω –æ—Ç –ø–æ—Ç–µ—Ä–∏ —Ö–æ—Å—Ç–∞ | Dev / —Ç–µ—Å—Ç |
| üîπ **–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–∞ —Ö–æ—Å—Ç–µ** | –õ–µ–≥–∫–æ –±—ç–∫–∞–ø–∏—Ç—å | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ | Dev / –º–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã |
| üîπ **–û–±–ª–∞–∫–æ (S3, Google Cloud, Yandex Object Storage)** | –ù–∞–¥—ë–∂–Ω–æ, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ | –ù—É–∂–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ | –ü—Ä–æ–¥–∞–∫—à–µ–Ω |
| üîπ **NFS / —Å–µ—Ç–µ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** | –û–±—â–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ | –°–ª–æ–∂–Ω–µ–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ | –ö–æ–º–∞–Ω–¥—ã, CI |
| üîπ **–î—Ä—É–≥–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `minio` –∏–ª–∏ `backup-container`)** | –í—Å—ë –≤ Docker | –¢—Ä–µ–±—É–µ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ | DevOps-–ø–æ–¥—Ö–æ–¥ |

---

## ‚è∞ –ö–∞–∫ —á–∞—Å—Ç–æ –¥–µ–ª–∞—é—Ç –¥–∞–º–ø—ã?

### üü¢ **–ú–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã / —Å—Ç–∞—Ä—Ç–∞–ø—ã / MVP**
- **–†–∞–∑ –≤ —Å—É—Ç–∫–∏** (–Ω–æ—á—å—é, –ø—Ä–∏ –Ω–∏–∑–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ)
- –í—Ä–µ–º—è: `02:00` –∏–ª–∏ `03:00` ‚Äî –∫–æ–≥–¥–∞ –º–∞–ª–æ —Ç—Ä–∞—Ñ–∏–∫–∞

### üü° **–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç—ã (—Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)**
- **–ö–∞–∂–¥—ã–µ 6‚Äì12 —á–∞—Å–æ–≤**
- –ü–ª—é—Å: **–±–∏–Ω–∞—Ä–Ω—ã–µ –ª–æ–≥–∏ (MySQL binlog)** –∏–ª–∏ **WAL (PostgreSQL)** ‚Äî –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ –º–∏–Ω—É—Ç—ã

### üî¥ **–ö—Ä—É–ø–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã (—Ñ–∏–Ω–∞–Ω—Å—ã, e-commerce)**
- **–ö–∞–∂–¥—ã–π —á–∞—Å** ‚Äî –ø–æ–ª–Ω—ã–π –¥–∞–º–ø
- **–ö–∞–∂–¥—ã–µ 5‚Äì15 –º–∏–Ω—É—Ç** ‚Äî –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã –∏–ª–∏ –ø–æ—Ç–æ–∫–æ–≤–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç **WAL-–∞—Ä—Ö–∏–≤–∞—Ü–∏—é (PostgreSQL)** –∏–ª–∏ **XtraBackup (MySQL)**

---

## üõ†Ô∏è –ö–∞–∫ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ?

### –ü—Ä–∏–º–µ—Ä: **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–º–ø PostgreSQL –≤ Docker ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±–ª–∞–∫–æ**

#### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å PostgreSQL ‚Üí –¥–∞–Ω–Ω—ã–µ –≤ `db-data` volume
- –û—Ç–¥–µ–ª—å–Ω—ã–π **backup-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** –∏–ª–∏ **cron-–∑–∞–¥–∞—á–∞ –Ω–∞ —Ö–æ—Å—Ç–µ**
- –î–∞–º–ø –¥–µ–ª–∞–µ—Ç—Å—è ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `backup-volume` ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ **S3**

#### 2. –ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±: `cron` + —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Ö–æ—Å—Ç–µ

```bash
# /etc/cron.daily/postgres-backup
#!/bin/bash

TIMESTAMP=$(date +"%Y-%m-%d_%H-%M")
BACKUP_DIR="/backups/postgres"
DUMP_FILE="$BACKUP_DIR/dump-$TIMESTAMP.sql"

# –°–æ–∑–¥–∞—ë–º –¥–∞–º–ø
docker exec postgres-db pg_dump -U postgres myapp_db > "$DUMP_FILE"

# –°–∂–∏–º–∞–µ–º
gzip "$DUMP_FILE"

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –æ–±–ª–∞–∫–æ (–ø—Ä–∏–º–µ—Ä: AWS CLI)
aws s3 cp "$DUMP_FILE.gz" s3://my-backups/postgres/

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã (–æ—Å—Ç–∞–≤–∏—Ç—å 7 –¥–Ω–µ–π)
find "$BACKUP_DIR" -name "*.sql.gz" -mtime +7 -delete
```

–î–æ–±–∞–≤–∏—Ç—å –≤ cron:

```bash
sudo crontab -e
```

```cron
0 2 * * * /etc/cron.daily/postgres-backup
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: **–í–Ω—É—Ç—Ä–∏ Docker ‚Äî —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å**

```yaml
# docker-compose.yml
version: '3.8'

services:
  db:
    image: postgres:15
    volumes:
      - db-/var/lib/postgresql/data
    environment:
      POSTGRES_DB: myapp
      POSTGRES_PASSWORD: secret

  backup:
    image: postgres:15
    volumes:
      - ./backups:/backups
      - ./scripts/backup.sh:/backup.sh
    environment:
      AWS_ACCESS_KEY_ID: xxx
      AWS_SECRET_ACCESS_KEY: yyy
    command: |
      /bin/sh -c "
      while true; do
        echo '–í—ã–ø–æ–ª–Ω—è—é –±—ç–∫–∞–ø...'
        pg_dump -h db -U postgres myapp | gzip > /backups/dump-$(date +%F).sql.gz
        aws s3 cp /backups/dump-$(date +%F).sql.gz s3://my-bucket/
        sleep 86400  # —Ä–∞–∑ –≤ 24 —á–∞—Å–∞
      done
      "
    depends_on:
      - db

volumes:
  db-
  # backups ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç—Å—è
```

---

## üßº –ß—Ç–æ –µ—â—ë –¥–µ–ª–∞—é—Ç –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö?

| –î–µ–π—Å—Ç–≤–∏–µ | –ó–∞—á–µ–º |
|--------|------|
| üîñ **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–∞–º–ø–æ–≤ —Å –º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏** | `dump-2025-04-05-02-00.sql` |
| üóëÔ∏è **–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (7, 14, 30 –¥–Ω–µ–π) |
| üîê **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–º–ø–æ–≤** | –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ |
| üì¨ **–û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –±—ç–∫–∞–ø–µ** | Slack, Telegram: "–ë—ç–∫–∞–ø —É—Å–ø–µ—à–Ω–æ —Å–¥–µ–ª–∞–Ω" |
| üß™ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏** | –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–º–ø –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é |

---

## üö´ –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

1. **–î–∞–º–ø—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–æ–º –∂–µ volume, —á—Ç–æ –∏ –ë–î** ‚Üí –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ volume‚Äô–∞ ‚Äî **–≤—Å—ë –ø—Ä–æ–ø–∞–ª–æ**.
2. **–ù–∏–∫–∞–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤** ‚Üí "—É –Ω–∞—Å –º–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–æ–µ–∫—Ç, –Ω–µ –Ω–∞–¥–æ" ‚Üí –ø–æ—Ç–æ–º –ø–ª–∞—á—É—Ç.
3. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** ‚Üí –∞ –¥–∞–º–ø –æ–∫–∞–∑–∞–ª—Å—è –±–∏—Ç—ã–º.
4. **–ë—ç–∫–∞–ø —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ** ‚Üí —Å–µ—Ä–≤–µ—Ä —Å–≥–æ—Ä–µ–ª ‚Äî –∏ –±—ç–∫–∞–ø—ã —Å –Ω–∏–º.

---

## ‚úÖ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

| –ü—Ä–∞–≤–∏–ª–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|--------|
| ‚úÖ 3-2-1 backup rule | 3 –∫–æ–ø–∏–∏, 2 –Ω–æ—Å–∏—Ç–µ–ª—è, 1 –≤–Ω–µ —Å–∞–π—Ç–∞ |
| ‚úÖ –î–µ–ª–∞—Ç—å –¥–∞–º–ø—ã **–≤–Ω–µ –ø–∏–∫–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏** | –ß—Ç–æ–±—ã –Ω–µ —Ç–æ—Ä–º–æ–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pg_dump --jobs` –∏–ª–∏ `mysqldump --single-transaction` | –î–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ |
| ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë | –í—Ä—É—á–Ω—É—é ‚Äî –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è |
| ‚úÖ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ | "–ë—ç–∫–∞–ø –µ—Å—Ç—å ‚Äî –∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–ª—å–∑—è" = –Ω–µ—Ç –±—ç–∫–∞–ø–∞ |

---

## üß© –ü—Ä–∏–º–µ—Ä: 3-2-1 –ø—Ä–∞–≤–∏–ª–æ

- **3 –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö**:
  1. –û—Å–Ω–æ–≤–Ω–∞—è –ë–î
  2. –õ–æ–∫–∞–ª—å–Ω—ã–π –±—ç–∫–∞–ø (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
  3. –û–±–ª–∞–∫–æ (S3)

- **2 —Ç–∏–ø–∞ –Ω–æ—Å–∏—Ç–µ–ª–µ–π**:
  - SSD (–ë–î)
  - –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3)

- **1 –∫–æ–ø–∏—è –≤–Ω–µ —Å–∞–π—Ç–∞**:
  - S3 –≤ –¥—Ä—É–≥–æ–º —Ä–µ–≥–∏–æ–Ω–µ

---

## üí° –í—ã–≤–æ–¥

> –í —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö:
>
> - –î–∞–º–ø—ã **–Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ volume‚Äô–µ —Å –ë–î**, –∞ **—Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ**.
> - –ß–∞—Å—Ç–æ—Ç–∞: **–æ—Ç —Ä–∞–∑–∞ –≤ —Å—É—Ç–∫–∏ –¥–æ –∫–∞–∂–¥—ã—Ö 15 –º–∏–Ω—É—Ç**, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏.
> - –î–∞–º–ø—ã **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã**, **–∞—Ä—Ö–∏–≤–∏—Ä—É—é—Ç—Å—è**, **–æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –æ–±–ª–∞–∫–æ**, **–ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è**.
> - –ò—Å–ø–æ–ª—å–∑—É—é—Ç **—Å–æ—á–µ—Ç–∞–Ω–∏–µ –¥–∞–º–ø–æ–≤ + –±–∏–Ω–∞—Ä–Ω—ã—Ö –ª–æ–≥–æ–≤ / WAL** –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

---

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É —Å–∫–∏–Ω—É—Ç—å **–≥–æ—Ç–æ–≤—ã–π bash-—Å–∫—Ä–∏–ø—Ç + docker-compose.yml** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞ PostgreSQL –≤ S3. –ù–∞–ø–∏—à–∏, –∫–∞–∫–æ–π —É —Ç–µ–±—è –æ–±–ª–∞–∫–æ (AWS, Yandex, Google –∏ —Ç.–¥.) ‚Äî –∞–¥–∞–ø—Ç–∏—Ä—É—é. üòä